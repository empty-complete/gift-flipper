# bot-gateway

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π Telegram-–±–æ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π Gift Flipper**

## üéØ –¶–µ–ª—å —Å–µ—Ä–≤–∏—Å–∞

–û–±–µ—Å–ø–µ—á–∏—Ç—å —É–¥–æ–±–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Å–∏—Å—Ç–µ–º–æ–π:

- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –±–æ—Ç–µ.
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ–∏—Å–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤.
- –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –≤—ã–≥–æ–¥–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–∞—Ö.
- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π —Å–¥–µ–ª–æ–∫ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–∞–¥–º–∏–Ω–∫–∞)

## üîç –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (–ø–ª–∞–Ω)

- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–∏–±–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–ø–æ —Ü–µ–Ω–µ, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, —Ä–µ–¥–∫–æ—Å—Ç–∏ –∏ —Ç.–¥.).
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—Ä—è–º–æ –∏–∑ –±–æ—Ç–∞.

## üõ† TODO

### bot-gateway/T1 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è & —Å–∫–µ–ª–µ—Ç (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∂–∏–≤–æ–π –±–æ—Ç)

- [x] `pyproject.toml` —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏: `aiogram`, `pydantic-settings`, `httpx`, `uvloop`, `pytest`, `pytest-asyncio`, `mypy`, `ruff`
- [x] `bot_gateway/config.py`: ~~Pydantic Settings (+ –∑–∞–≥—Ä—É–∑–∫–∞ `.env`)~~ Dynaconf (+–∑–∞–≥—Ä—É–∑–∫–∞ `settings.toml` + `.secrets.toml` + `.example`)
- [ ] `bot_gateway/logging.py`: –∫–æ—Ä–Ω–µ–≤–æ–π –ª–æ–≥–≥–µ—Ä, —Ñ–æ—Ä–º–∞—Ç JSON/console, –ø–æ–ª–µ `request_id`
- [x] `bot_gateway/bot/factory.py`: —Å–±–æ—Ä–∫–∞ `Bot`, `Dispatcher`, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤
- [ ] `bot_gateway/bot/routers/`: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤
- [ ] `bot_gateway/bot/routers/start.py`: —Ö–µ–Ω–¥–ª–µ—Ä `/start` (–ø–æ–∫–∞ **–±–µ–∑** API) ‚Üí ‚Äú–ü—Ä–∏–≤–µ—Ç! –ú–µ–Ω—é: /menu‚Äù
- [ ] `bot_gateway/bot/routers/menu.py`: –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (‚Äú–ü—Ä–æ—Ñ–∏–ª—å‚Äù, ‚Äú–§–∏–ª—å—Ç—Ä—ã‚Äù ‚Äî –ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∏)
- [ ] `bot_gateway/main.py`: –∑–∞–ø—É—Å–∫ polling
- [ ] `tests/test_start.py`: smoke-—Ç–µ—Å—Ç `/start`
- [ ] `Makefile`: `run`, `fmt`, `lint`, `test`, `ci`

### bot-gateway/T2 ‚Äî –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

- [ ] `middlewares/correlation.py`: –ø—Ä–æ–∫–∏–¥–∫–∞/–≥–µ–Ω–µ—Ä–∞—Ü–∏—è `X-Request-Id`
- [ ] `middlewares/userctx.py`: –∏–∑–≤–ª–µ–∫–∞–µ–º `tg_id`, `username`, `lang` ‚Üí –∫–æ–Ω—Ç–µ–∫—Å—Ç
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å middlewares –≤ `factory.py`
- [ ] –õ–æ–≥–∏ —Å `request_id`, `tg_id`

### bot-gateway/T3 ‚Äî –ö–ª–∏–µ–Ω—Ç –∫ control-api + –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–π /start

- [ ] `clients/schemas.py`: DTO –¥–ª—è `/start` –∏ –æ—Ç–≤–µ—Ç–æ–≤
- [ ] `clients/control_api.py`: httpx-–∫–ª–∏–µ–Ω—Ç —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏ –∏ —Ä–µ—Ç—Ä–∞—è–º–∏
- [ ] `routers/start.py`: `POST /start` ‚Üí –º–µ–Ω—é (`created=true/false`)
- [ ] –û—à–∏–±–∫–∏ 4xx/5xx ‚Üí ‚Äú—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞‚Äù + POST `/log`
- [ ] `tests/test_control_api_client.py`: –º–æ–∫ –∫–ª–∏–µ–Ω—Ç–∞

### bot-gateway/T4 ‚Äî –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∏ –ø—Ä–æ—Ñ–∏–ª—å (—á—Ç–µ–Ω–∏–µ)

- [ ] `keyboards/common.py`: –∫–Ω–æ–ø–∫–∏ ‚Äú–ü—Ä–æ—Ñ–∏–ª—å‚Äù, ‚Äú–§–∏–ª—å—Ç—Ä—ã‚Äù, ‚Äú–ù–∞–∑–∞–¥‚Äù
- [ ] `clients/control_api.py`: `GET /users/{tg_id}`, `GET /users/{tg_id}/filters`
- [ ] `menu.py`: –ø—Ä–æ—Ñ–∏–ª—å –∏ —Ñ–∏–ª—å—Ç—Ä—ã
- [ ] –¢–µ—Å—Ç—ã —Ä–µ–Ω–¥–µ—Ä–∞

### bot-gateway/T5 ‚Äî FSM ‚Äú–§–∏–ª—å—Ç—Ä—ã‚Äù (–º–∏–Ω–∏–º—É–º: clean: bool)

- [ ] `states/filters.py`: FSM –¥–ª—è clean
- [ ] `routers/filters.py`: `PUT /users/{tg_id}/filters`
- [ ] –û—Ç–≤–µ—Ç 200 ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- [ ] –û—à–∏–±–∫–∏ ‚Üí ‚Äú—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞‚Äù + `POST /log`

### bot-gateway/T6 ‚Äî –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ + /log

- [ ] `routers/errors.py`: –≥–ª–æ–±–∞–ª—å–Ω—ã–π handler
- [ ] `clients/control_api.py`: `POST /log`
- [ ] –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ `/log`

### bot-gateway/T7 ‚Äî –ü–æ–ª–∏—Ä–æ–≤–∫–∞ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

- [ ] –¢–∞–π–º–∞—É—Ç—ã/—Ä–µ—Ç—Ä–∞–∏ –≤ http-–∫–ª–∏–µ–Ω—Ç–µ
- [ ] –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è RU/EN
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ª–æ–≥–∏ (json/plain)
- [ ] –ú–µ—Ç—Ä–∏–∫–∞ –≤ –ª–æ–≥–∞—Ö

### bot-gateway/T8 ‚Äî –¢–µ—Å—Ç—ã –∏ –∫–∞—á–µ—Å—Ç–≤–æ

- [ ] Unit-—Ç–µ—Å—Ç—ã –Ω–∞ –≤—Å–µ –≤–µ—Ç–∫–∏
- [ ] `ruff` + `mypy` —á–∏—Å—Ç–æ
- [ ] `make ci` ‚Äî lint + test

### bot-gateway/T9 ‚Äî Docker & –ª–æ–∫–∞–ª—å–Ω—ã–π compose

- [ ] `Dockerfile` (slim, uv build)
- [ ] `make docker`
- [ ] –ü—Ä–∏–º–µ—Ä `docker run` –≤ README w
- [ ] bot-gateway/T10 ‚Äî CI/CD
- [ ] **CI**: GitHub Actions ‚Üí lint + tests
- [ ] **CD**: build & push Docker image –ø–æ —Ç–µ–≥—É

**–ü—Ä–∏–º–µ—Ä –∫–æ–º–º–∏—Ç–∞**:
`bot-gateway/T1: scaffold package and minimal /start, /menu`

## üñ• –°—Ç–µ–∫

- Python 3.10+
- aiogram (v3+)
- pydantic
- pytest, pytest-asyncio
- pre-commit, ruff, mypy
- Docker
